# CHANGELOG

## [0.2.0] - 2026-FEB-04

### Added
- **Cloud Native архитектура** - полное соответствие 12-Factor App принципам
- **Stateless Docker образ** - кэш больше не создается внутри образа
- **Гибкое управление кэшем** через:
  - Переменные окружения `MITRE_CACHE_DIR`
  - Флаги командной строки: `--cache-dir`, `--no-cache`, `--force-refresh`
  - Автоматическое определение среды выполнения (контейнер/локально)
- **Улучшенная обработка ошибок** - устранено игнорирование ошибок записи кэша
- **Атомарная запись кэша** - использование временных файлов для избежания повреждений
- **Расширенные команды Makefile**:
  - `make docker-test` - полное тестирование Docker образа
  - `make docker-run-nocache` - запуск без кэширования
  - `make docker-run-volume` - запуск с Docker volume
  - `make app-help` - корректный вывод справки без ошибок
- **Безопасные режимы работы Docker**:
  - Поддержка `--read-only` режима
  - Работа с `tmpfs` для in-memory кэша
  - Использование непривилегированного пользователя в контейнере

### Changed
- **Рефакторинг архитектуры** - разделение логики определения пути кэша
- **Изменение поведения в контейнерах** - кэш по умолчанию создается в `/tmp/.mitre-cache`
- **Обновлен Dockerfile** - удалена директория `.mitre-cache` из образа
- **Переработана логика флагов** - `-h` теперь возвращает код 0 (успех)
- **Улучшены тесты** - теперь проверяют отсутствие кэша в образе и stateless-работу
- **Обновлены mount точки** - том монтируется в `/tmp/.mitre-cache` вместо `/app/.mitre-cache`

### Fixed
- **Критический баг** - `make app-help` завершался с ошибкой 1
- **Проблема форматирования** - исправлена опечатка `%!s(MISSING)` в тексте справки
- **Безопасность Docker** - кэш больше не сохраняется внутри образа
- **Обработка ошибок HTTP** - добавлены таймауты и ограничение размера скачиваемого файла
- **Права доступа** - исправлены проблемы с правами на запись в volume

### Security
- **Уменьшена поверхность атаки** - контейнер не содержит лишних данных
- **Stateless по умолчанию** - данные кэша не сохраняются в образе
- **Автоматическое определение контейнера** - функция `isRunningInContainer()` проверяет несколько признаков
- **Безопасные пути по умолчанию** - в контейнерах используется `/tmp/` для временных данных
- **Грамотное управление кэшем** - возможность отключения кэша через `--no-cache`

### Technical Details
- **Язык**: Go 1.25.6
- **Зависимости**: Стандартная библиотека Go + атомарная запись файлов
- **Формат данных**: MITRE ATT&CK STIX 2.0 JSON
- **Кэширование**: Локальная файловая система, Docker volumes, tmpfs
- **Размер образа**: ~13.9MB (чистый образ без кэша)
- **Архитектура**: Cloud Native, готово к deployment в Kubernetes
- **Лицензия**: MIT

### Breaking Changes
- **Для Docker пользователей**: Точка монтирования кэша изменена с `/app/.mitre-cache` на `/tmp/.mitre-cache`
- **Для CLI пользователей**: Добавлены новые флаги `--cache-dir`, `--no-cache`, `--force-refresh`
- **Переменные окружения**: `MITRE_CACHE_DIR` теперь имеет высший приоритет при определении пути кэша

### Migration Guide
1. **Docker пользователи**: Обновите команды запуска, заменив `/app/.mitre-cache` на `/tmp/.mitre-cache`
2. **CI/CD пайплайны**: Используйте `--no-cache` для stateless выполнения
3. **Production развертывания**: Используйте Docker volumes или внешнее хранилище для кэша

### Known Limitations
- **Размер образа**: 13.9MB (можно уменьшить до ~4.7MB с использованием scratch/distroless образов)
- **Архитектура**: Остается монолитной (планируется модульный рефакторинг в v0.3.0)
- **Тестирование**: Unit-тесты еще не добавлены (планируется в v0.4.0)

---

## [0.1.0] - 2026-FEB-03

### Added
- Базовый функционал для поиска техник MITRE ATT&CK по митигации
- Поддержка 4 форматов вывода:
  - Табличный формат (по умолчанию)
  - JSON формат (`-json`)
  - CSV формат (`-csv`)
  - nGQL INSERT statements для Nebula Graph (`-ngql`)
- Автоматическая загрузка MITRE ATT&CK Enterprise STIX бандла
- Локальное кэширование бандла в директории `.mitre-cache/`
- Поиск контрмер по:
  - Идентификатору MITRE (например, `M1037`)
  - Названию контрмеры (регистронезависимый)
- Поддержка отладочного режима (`-debug`)

### Технические детали реализации
- Язык: Go
- Зависимости: стандартная библиотека Go
- Формат данных: MITRE ATT&CK STIX 2.0 JSON
- Кэширование: локальная файловая система
- Лицензия: MIT

### Известные ограничения
- Монолитная архитектура без разделения на модули
- Глобальная переменная для флага отладки
- Основная логика сосредоточена в функции `main()`
- Конфигурация hardcoded в коде
- Отсутствие unit-тестов
- Частичная обработка ошибок

---

## Roadmap

### v0.3.0 (Планируется Q1 2026)
- **Модульная архитектура** - разделение на пакеты (mitre, nebula, output)
- **Интеграция с Nebula Graph** - реальное подключение вместо генерации nGQL
- **Полная синхронизация данных** - все сущности MITRE ATT&CK

### v0.4.0 (Планируется Q2 2026)
- **Unit-тесты** - покрытие >80%
- **Интеграционные тесты** - с MITRE API и Nebula Graph
- **Prometheus метрики** - мониторинг и observability

### v1.0.0 (Планируется Q3 2026)
- **Production готовность** - Helm charts, Kubernetes manifests
- **Документация** - полная API и deployment документация
- **Поддержка enterprise** - аутентификация, авторизация, аудит

---

**Примечание**: Все даты являются ориентировочными и могут быть изменены в зависимости от приоритетов разработки.
